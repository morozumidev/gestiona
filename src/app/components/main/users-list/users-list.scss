@use "sass:color";
@use "../../../../global_variables" as global;

/* ================== Tokens M3 heredados (ya definidos globalmente por ti) ================== */
/* Usamos los tokens --mat-sys-* para superficies/contrastes y definimos “brand” vivos encima. */

:host {
  /* Brand vivos (inspirados en tus ejemplos) — overrideables por tema/tenant */
  --brand-primary: #008cff;
  --brand-accent:  #f72585;
  --brand-success: #16a34a;
  --brand-warning: #ffb11f;
  --brand-error:   #ff0015;
  --brand-gray-200: #e5e7eb;
  --brand-gray-400: #9ca3af;
  --brand-indigo-100: #d0dbf7;

  /* Layout */
  --radius: 16px;

  /* Derivadas desde M3 (no “hardcodeamos” fondos/contrastes) */
  --divider: var(--mat-sys-outline-variant);
  --head-grad: color-mix(in oklab, var(--mat-sys-surface-container-highest) 92%, transparent);
  --row-hover: color-mix(in oklab, var(--mat-sys-surface-container-high) 75%, transparent);
  --shadow-1: var(--mat-sys-level1);
  --shadow-2: var(--mat-sys-level2);
}

/* ================== Animaciones ================== */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes scaleIn {
  from { opacity: 0; transform: scale(0.95); }
  to   { opacity: 1; transform: scale(1); }
}
.fadeIn { animation: fadeIn .5s ease; }
.scaleIn { animation: scaleIn .4s ease-out; }

/* ================== Helpers / Glass ================== */
.glass-card { @include global.glass-overlay; }

/* Contenedor principal */
.users-container.container {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  color: var(--mat-sys-on-surface);
}

/* Toolbar compacta */
.toolbar.compact-header {
  display: flex; align-items: center; gap: 12px;
  padding: 12px 14px; border-radius: var(--radius);
  background: color-mix(in oklab, var(--mat-sys-surface) 85%, transparent);
  box-shadow: var(--shadow-1);

  .title {
    display: inline-flex; align-items: center; gap: 10px;
    font-size: 22px; font-weight: 800; letter-spacing: .2px;

    mat-icon { color: var(--mat-sys-primary); }
    .counter { color: var(--mat-sys-on-surface-variant); font-weight: 600; }
  }
  .spacer { flex: 1 1 auto; }
  .btn-new mat-icon { margin-right: 6px; }
}

/* Filtros */
.search-field {
  border-radius: var(--mat-sys-corner-large, var(--radius));
  padding: 1rem 1.5rem;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 12px; align-items: start;

  .w-flex { grid-column: 1 / -1; }
  .filters-actions { display: flex; align-items: center; }
}

/* ================== Tabla / Alineación de headers ================== */
.table-container {
  padding: 1rem;
  border-radius: var(--radius);
  overflow: auto; /* Scroll horizontal/vertical sin romper layout */
  position: relative;
}

/* Reglas clave para evitar descuadre */
table.glass-table {
  width: 100%;
  border-collapse: collapse;       /* ✅ evita offset entre thead/tbody */
  table-layout: fixed;             /* ✅ fija anchos por colgroup */
  /* (Angular Material ya aporta display table; no usar grid aquí) */

  /* Sticky header dentro de la misma tabla */

  /* Colgroup: define anchos consistentes por columna */
  col.col-name    { width: 26%; }
  col.col-email   { width: 28%; }
  col.col-role    { width: 16%; }
  col.col-area    { width: 20%; }
  col.col-actions { width: 10%; } /* ✅ evita “bailes” por iconos */

  th.mat-mdc-header-cell,
  td.mat-mdc-cell {
    padding: 12px 16px;            /* ✅ misma caja para ambos */
    box-sizing: border-box;
    vertical-align: middle;
    overflow: hidden;              /* con table-layout: fixed */
    text-overflow: ellipsis;
    white-space: nowrap;
    border-bottom: 1px solid var(--divider);
  }



  tr.data-row:hover {
    background: var(--row-hover);
  }

  .td-actions {
    text-align: right;
    white-space: nowrap;
  }
}

/* Nombre + avatar */
.name {
  display: grid;
  grid-template-columns: 28px 1fr;
  gap: 10px; align-items: center;

  .avatar-icon {
    width: 28px; height: 28px; line-height: 28px;
    border-radius: 50%;
    background: var(--mat-sys-secondary-container);
    color: var(--mat-sys-on-secondary-container);
    border: 1px solid var(--divider);
    display: inline-flex; align-items: center; justify-content: center;
    font-size: 20px;
  }

  .name-stack {
    min-width: 0;
    .primary   { font-weight: 700; overflow: hidden; text-overflow: ellipsis; }
    .lastname  { color: var(--mat-sys-on-surface-variant); font-size: 12px; overflow: hidden; text-overflow: ellipsis; }
  }
}

/* Utilidad ellipsis */
.cell-ellipsis {
  display: inline-block;
  max-width: 28ch;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

/* ================== Paleta viva (badges, textos, icon buttons) ================== */
/* Badges base */
.badge {
  display: inline-block;
  padding: .25rem .75rem;
  font-size: .75rem;
  font-weight: 700;
  border-radius: 1rem;
  text-transform: uppercase;
  letter-spacing: .5px;
  box-shadow: 0 2px 4px rgba(0,0,0,.08);
  border: 1px solid transparent;
  user-select: none;
  white-space: nowrap;
}

/* Variantes vivas */
.badge-dark {
  background-color: var(--brand-gray-200);
  color: #111827;
  border-color: var(--brand-gray-400);
}
.badge-primary {
  background-color: color-mix(in srgb, var(--brand-primary) 16%, #fff);
  color: color-mix(in srgb, var(--brand-primary) 96%, #000);
  border-color: color-mix(in srgb, var(--brand-primary) 45%, #fff);
}
.badge-accent {
  background-color: color-mix(in srgb, var(--brand-accent) 16%, #fff);
  color: color-mix(in srgb, var(--brand-accent) 96%, #000);
  border-color: color-mix(in srgb, var(--brand-accent) 45%, #fff);
}
.badge-success {
  background-color: color-mix(in srgb, var(--brand-success) 16%, #fff);
  color: color-mix(in srgb, var(--brand-success) 96%, #000);
  border-color: color-mix(in srgb, var(--brand-success) 45%, #fff);
}
.badge-warning {
  background-color: color-mix(in srgb, var(--brand-warning) 22%, #fff);
  color: color-mix(in srgb, var(--brand-warning) 96%, #000);
  border-color: color-mix(in srgb, var(--brand-warning) 55%, #fff);
}
.badge-error {
  background-color: color-mix(in srgb, var(--brand-error) 16%, #fff);
  color: color-mix(in srgb, var(--brand-error) 96%, #000);
  border-color: color-mix(in srgb, var(--brand-error) 45%, #fff);
}

/* Chip de rol hereda estilos vivos */
.role-chip.mat-mdc-standard-chip {
  @extend .badge;
  @extend .badge-primary;
  backdrop-filter: blur(6px);

  mat-icon { margin-right: 6px; font-size: 18px; opacity: .9; }
}

/* Utilidades de texto vivo (por si las necesitas en otras celdas) */
.text-primary { color: color-mix(in srgb, var(--brand-primary) 90%, #000); }
.text-accent  { color: color-mix(in srgb, var(--brand-accent)  90%, #000); }
.text-success { color: color-mix(in srgb, var(--brand-success) 90%, #000); }
.text-warning { color: color-mix(in srgb, var(--brand-warning) 90%, #000); }
.text-error   { color: color-mix(in srgb, var(--brand-error)   90%, #000); }

/* Icon buttons con acento vivo (inspirado) */
.mat-mdc-icon-button {
  transition: transform .2s ease-in-out, background-color .2s ease-in-out, opacity .2s;
  margin-inline: 2px; opacity: .95;

  &:hover {
    transform: scale(1.1);
    border-radius: 50%;
    background-color: color-mix(in srgb, var(--mat-sys-primary) 10%, transparent);
  }

  &.mat-primary mat-icon { color: var(--brand-primary); }
  &.mat-accent  mat-icon { color: var(--brand-accent);  }
}

/* Empty state */
.empty-state {
  text-align: center; padding: 40px; border-radius: var(--radius); margin: 20px 0;

  .mat-icon { font-size: 64px; width: 64px; height: 64px; margin-bottom: 20px; color: var(--brand-primary); }
  h3 { margin: 10px 0; color: var(--mat-sys-on-surface); font-size: 22px; }
  p  { color: var(--mat-sys-on-surface-variant); font-size: 16px; max-width: 520px; margin: 0 auto; }
}

/* Paginador en glass */
mat-paginator {
  margin-top: 1rem;
  background: color-mix(in oklab, var(--mat-sys-surface) 85%, transparent);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  box-shadow: 0 -2px 10px rgba(0,0,0,.1);
}



/* ================== Responsivo / Accesibilidad ================== */
@media (max-width: 720px) {
  .toolbar.compact-header { padding: 10px; flex-direction: column; align-items: flex-start; }
  .search-field { grid-template-columns: 1fr; }
  .cell-ellipsis { max-width: 20ch; }
}

table.glass-table .mat-mdc-header-cell.sortable:focus-visible {
  outline: 2px solid var(--brand-primary);
  outline-offset: 2px;
  border-radius: 8px;
}
